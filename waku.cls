\NeedsTeXFormat{LaTeX2e}
\ProvidesClass{waku}[2021/11/19]

\newif\iflandscape\landscapefalse
\DeclareOption{landscape}{\landscapetrue}
\ProcessOptions\relax
\newif\ifgrid\gridfalse
\DeclareOption{grid}{\gridtrue}
\ProcessOptions\relax

\iflandscape
	\LoadClass[
		jafontsize=2.5mm,
		baselineskip=1.1zh,
		line_length=88mm,
		cmyk,
		paper={88mm,63mm},
		gutter=0pt,
		head_space=0pt,
		foot_space=0pt,
		fore-edge=0pt,
		open_bracket_pos=nibu_tentsuki,
		hanging_punctuation,
	]{jlreq}
\else
	\LoadClass[
		jafontsize=2.5mm,
		baselineskip=1.1zh,
		line_length=63mm,
		cmyk,
		paper={63mm,88mm},
		gutter=0pt,
		head_space=0pt,
		foot_space=0pt,
		fore-edge=0pt,
		open_bracket_pos=nibu_tentsuki,
		hanging_punctuation,
	]{jlreq}
\fi

\RequirePackage[dvipsnames]{xcolor}

\RequirePackage{luatexja,xparse,fontspec,bxokumacro,bxghost,ifthen,xkeyval}
\RequirePackage{amsmath}
\ltjsetparameter{jacharrange={-3,-8}}
\RequirePackage[no-math,match,deluxe]{luatexja-preset}
\RequirePackage[x-1a]{pdfx}

\RequirePackage[pdfbox]{gentombow}
\settombowbleed{3mm}

\RequirePackage{tikz}
\usetikzlibrary{calc,fadings,patterns,arrows.meta,shapes.symbols}
\setlength{\parskip}{0pt}
\RequirePackage[export]{adjustbox}

\RequirePackage{luacode}
%% \PUACHAR{Â«numÂ»}
% ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒ num ã§ã‚ã‚‹æ–‡å­—ã‚’å‡ºåŠ›ã™ã‚‹
\begin{luacode*}
	my = my or {}
	function my.pua(n)
		local t, c = font.getfont(font.current()), 0
		if t and t.shared and t.shared.rawdata and t.shared.rawdata.descriptions then
			for i,v in pairs(t.shared.rawdata.descriptions) do
				if not v.name and v.unicode==n then c=i; break end
			end
		end
		tex.sprint(tostring(c))
	end
\end{luacode*}
\def\PUACHAR#1{\char\directlua{my.pua(\the\numexpr#1)}}

\defaultjfontfeatures{
	Ligatures=TeX,
	YokoFeatures={JFM=jlreq},   % jlreqã®JFMã‚’ç¶­æŒã™ã‚‹
	TateFeatures={JFM=jlreqv},  % https://qiita.com/zr_tex8r/items/91ae1dcc9c3afce7fa8c
}
\defaultfontfeatures{
	WordSpace={.5,1,.3}
}
\setmainfont[Scale=1.2]{kawoszeh}
\setmainjfont{FOT-NewCinemaBStd-D.otf}
\setsansfont[Scale=1.2]{kawoszeh}
\setsansjfont{FOT-TsukuAntiqueLGoStd-B}
\newjfontfamily\hmsjfont[Scale=1]{FOT-TsukuAntiqueSMinStd-L}%æ¨ª
\newfontfamily\hmsafont[Scale=1]{FOT-TsukuAntiqueSMinStd-L}%æ¨ª
\newcommand{\hmsfont}{\hmsafont\hmsjfont}
\newjfontfamily\hmnjfont[Scale=1.0]{FOT-HummingPro-D}%ã‚«ãƒ¼ãƒ‰å
\newfontfamily\hmnafont[Scale=1.2]{kawoszeh}%ã‚«ãƒ¼ãƒ‰å
\newcommand{\hmnfont}{\hmnafont\hmnjfont}
\newfontfamily\hmcfont[Scale=1.1]{kawoszeh}%ã‚³ã‚¤ãƒ³
\newjfontfamily\hmsefont[Scale=1]{FOT-RodinNTLGPro-EB}%æ‹¡å¼µ
\newjfontfamily\hmhafont[Scale=1.0]{FOT-RodinNTLGPro-EB}%å®¶å®
\newfontfamily\hmhjfont[Scale=1.0]{FOT-RodinNTLGPro-EB}%å®¶å®
\newcommand{\hmhfont}{\hmhafont\hmhjfont}
\newfontfamily\hmvafont[Scale=1.1]{kawoszeh}%ãƒãƒ‹ãƒ©
\newjfontfamily\hmvjfont{FOT-HummingPro-D}%ãƒãƒ‹ãƒ©
\newcommand{\hmvfont}{\hmvafont\hmvjfont}
\newjfontfamily\hmajfont[Scale=1]{FOT-TsukuAntiqueSMinStd-L}%æ³¨é‡ˆ
\newfontfamily\hmaafont[Scale=1]{FOT-TsukuAntiqueSMinStd-L}%æ³¨é‡ˆ
\newcommand{\hmafont}{\hmaafont\hmajfont}

\renewcommand{\labelitemi}{\fontspec{nishiki-teki}\ltjalchar`â–¶ï¸}

\RequirePackage{pdfrender}
\NewDocumentCommand\hmfukuro{O{.2pt} +m O{white}}{\textpdfrender{
	TextRenderingMode=FillStroke,
	LineWidth=#1,
	FillColor=#3,
}{#2}}

\newlength{\OrigWidth}
%% \hminwidth[*]{Â«æ¨ªå¹…Â»}{Â«ãƒ†ã‚­ã‚¹ãƒˆÂ»}
% ãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ‡å®šã®æ¨ªå¹…ã«"ã‚¤ã‚¤ã‚«ãƒ³ã‚¸ã«"å‡ºåŠ›ã™ã‚‹
% *-> å‡ç­‰å‰²ã‚Šä»˜ã‘ã—ãªã„
\NewDocumentCommand\hminwidth{s m m}{{%
	\settowidth{\OrigWidth}{#3}% \settowidth ä¾¿åˆ©
	\ifthenelse{\lengthtest{\OrigWidth > #2}}{%
		% æŒ‡å®šå¹…ã‚ˆã‚Šå¤§ãã„å ´åˆã¯æ¨ªæ–¹å‘ã«ç¸®å°ã™ã‚‹
		\resizebox{#2}{\height}{#3}% æ¨ªå¹…ã ã‘å¤‰ãˆã‚‹
	}{%else
		\IfBooleanTF{#1}{%
			% * ä»˜ãã§æŒ‡å®šå¹…ä»¥ä¸‹ãªã‚‰ãã®ã¾ã¾å‡ºåŠ›
			#3
		}{%
			% æŒ‡å®šå¹…ä»¥ä¸‹ã®å ´åˆã¯å‡ç­‰å‰²ã‚Šã‚’è¡Œã†
			\kintou{#2}{\jghostguarded{}#3\jghostguarded{}}%
		}%
	}%
}}

\colorlet{gridcolor}{cyan!60}

\colorlet{ã‚¢ã‚¯ã‚·ãƒ§ãƒ³}{White}
\colorlet{è²¡å®}{Yellow}
\colorlet{å‹åˆ©ç‚¹}{Green}
\colorlet{ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³}{SkyBlue}
\colorlet{æŒç¶š}{YellowOrange}
\colorlet{é¿é›£æ‰€}{WildStrawberry}
\colorlet{å»ƒå¢Ÿ}{Peach}
\colorlet{ãƒªã‚¶ãƒ¼ãƒ–}{Apricot}
\colorlet{å¤œè¡Œ}{Gray}
\colorlet{ã‚¤ãƒ™ãƒ³ãƒˆ}{lightgray}
\colorlet{ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯}{olive}
\colorlet{ç¥ç¦}{yellow}
\colorlet{å‘ªè©›}{Thistle}
\colorlet{çŠ¶æ…‹}{pink}
\colorlet{ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ}{Tan}
\colorlet{ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ}{Lavender}
\colorlet{ç¿’æ€§}{CornflowerBlue}
\colorlet{å®¶å®}{Goldenrod}
\colorlet{åŸºæœ¬}{OliveGreen}
\colorlet{åŸºæœ¬2nd}{OliveGreen}
\colorlet{é™°è¬€}{ForestGreen}
\colorlet{é™°è¬€2nd}{ForestGreen}
\colorlet{æµ·è¾º}{ProcessBlue}
\colorlet{éŒ¬é‡‘è¡“}{Violet}
\colorlet{ç¹æ „}{LimeGreen}
\colorlet{åç©«ç¥­}{BurntOrange}
\colorlet{ç•°éƒ·}{YellowGreen}
\colorlet{æš—é»’æ™‚ä»£}{Mahogany}
\colorlet{ã‚®ãƒ«ãƒ‰}{Mulberry}
\colorlet{å†’é™º}{PineGreen}
\colorlet{å¸å›½}{Bittersweet}
\colorlet{å¤œæƒ³æ›²}{RoyalPurple}
\colorlet{ãƒ«ãƒã‚µãƒ³ã‚¹}{SeaGreen}
\colorlet{ç§»å‹•å‹•ç‰©åœ’}{Orange}
\colorlet{ãƒ—ãƒ­ãƒ¢}{Black}

\newcommand{\PlusAct}[1]{{\hmvfont\(+\text{#1}\) ã‚¢ã‚¯ã‚·ãƒ§ãƒ³}}
\newcommand{\PlusBuy}[1]{{\hmvfont\(+\text{#1}\) è³¼å…¥}}
\newcommand{\PlusCard}[1]{{\hmvfont\(+\text{#1}\) ãƒ‰ãƒ­ãƒ¼}}
\newcommand{\PlusCoin}[1]{{\hmvfont\(+\Coin{#1}\)}}
\newcommand{\PlusVP}[1]{{\hmvfont\(+\text{#1}\)\VP}}
\newcommand{\PlusCoffer}[1]{{\hmvfont\(+\text{#1}\) è²¡æº}}
\newcommand{\PlusVillager}[1]{{\hmvfont\(+\text{#1}\) æ‘äºº}}
\newcommand{\hmbar}{\par\hspace*{2\zw}\hrulefill\hspace*{2\zw}\par}

\newcommand{\ãƒ»}{\mbox{ãƒ»}}
\catcode`ã€€\active \newcommand{ã€€}{\mbox{\ã€€}}

\NewDocumentCommand\Coin{m s t+}{%
	\tikz[baseline=(T.base)]{
		\draw
		node[anchor=center,inner sep=0pt,outer sep=0pt,](T){\includegraphics[height=1.1\zh]{Coin.png}}
		node[anchor=center,inner sep=0pt,outer sep=0pt,font=\hmcfont](T)
		{\textcolor{black}{#1\textsuperscript{\IfBooleanT{#2}{*}\IfBooleanT{#3}{+}}}}
		node[anchor=center,inner sep=0pt,outer sep=0pt,font=\hmcfont](T){\phantom{1}};
	}%
}
\NewDocumentCommand\Debt{m}{%
	\tikz[baseline=(T.base)]{
		\draw
		node[anchor=center,inner sep=0pt,outer sep=0pt,](T){\includegraphics[height=1.1\zh]{Debt.png}}
		node[anchor=center,inner sep=0pt,outer sep=0pt,font=\hmcfont](T){\textcolor{white}{#1}}
		node[anchor=center,inner sep=0pt,outer sep=0pt,font=\hmcfont](T){\phantom{1}};
	}%
}
\NewDocumentCommand\VP{o}{%
	\IfValueT{#1}{#1}%
	\tikz[baseline=(T.base)]{
		\draw
		node[anchor=center,inner sep=0pt,outer sep=0pt,](T){\includegraphics[height=1.1\zh]{VP.png}}
		node[anchor=center,inner sep=0pt,outer sep=0pt,font=\hmcfont](T){\phantom{1}};
	}%
}
\NewDocumentCommand\Potion{}{%
	\tikz[baseline=(T.base)]{
		\draw
		node[anchor=center,inner sep=0pt,outer sep=0pt,](T){\includegraphics[height=1.1\zh]{Potion.png}}
		node[anchor=center,inner sep=0pt,outer sep=0pt,font=\hmcfont](T){\phantom{1}};
	}%
}

\define@cmdkeys{vanilla}[vanilla@]{card,action,buy,coin,coffer,villager,VP}
\NewDocumentCommand\Vanilla{d() o m}{%
	\begin{center}
		\setkeys{vanilla}{#3}%
		\IfValueT{#1}{{\Huge\Coin{#1}}\\}
		\IfValueT{#2}{{\Huge\VP[#2]}\\}
		\large
		\ifthenelse{\isundefined{\vanilla@card}}{}{\PlusCard{\vanilla@card}\\}
		\ifthenelse{\isundefined{\vanilla@action}}{}{\PlusAct{\vanilla@action}\\}
		\ifthenelse{\isundefined{\vanilla@buy}}{}{\PlusBuy{\vanilla@buy}\\}
		\ifthenelse{\isundefined{\vanilla@coin}}{}{\PlusCoin{\vanilla@coin}\\}
		\ifthenelse{\isundefined{\vanilla@coffer}}{}{\PlusCoffer{\vanilla@coffer}\\}
		\ifthenelse{\isundefined{\vanilla@villager}}{}{\PlusVillager{\vanilla@villager}\\}
		\ifthenelse{\isundefined{\vanilla@VP}}{}{\PlusVP{\vanilla@VP}\\}
	\end{center}
	\medskip
}

\define@cmdkeys{info}[]{MC,Cost,CostA,Type,Color,ColorB,Expantion,Artwork,å®¶å®,Copy}
\define@key{info}{ãƒˆãƒ©ãƒ™ãƒ©ãƒ¼}[ãƒˆãƒ©ãƒ™ãƒ©ãƒ¼]{\def\Travelar{#1}}
\NewDocumentCommand\CardInfo{m m t+ s o m +o +m o}{{%
	\newcommand{\CardNameEN}{#1}%
	\newcommand{\CardNameJA}{#2}%
	\newboolean{shortname}\setboolean{shortname}{false}%
	\newboolean{issuply}\setboolean{issuply}{false}%
	\newboolean{ispile}\setboolean{ispile}{false}%
	\IfBooleanT{#3}{\setboolean{shortname}{true}}%
	\IfBooleanT{#4}{\setboolean{issuply}{true}}%
	\IfValueT{#5}{\newcommand{\AdditionalCard}{#5}}%
	\setkeys{info}{#6}%
	\ifthenelse{\isundefined{\Type}}{\def\Type{ã‚¢ã‚¯ã‚·ãƒ§ãƒ³}}{}%
	\ifthenelse{\isundefined{\CostA}}{\def\CostA{\Coin{\Cost}}}{}%
	\ifthenelse{\equal{\Type}{è²¡å®}}{\def\Color{è²¡å®}}{}%
	\ifthenelse{\equal{\Type}{å‹åˆ©ç‚¹}}{\def\Color{å‹åˆ©ç‚¹}}{}%
	\ifthenelse{\equal{\Type}{å¤œè¡Œ}}{\def\Color{å¤œè¡Œ}}{}%
	\ifthenelse{\equal{\Type}{å‘ªã„}}{\def\Color{å‘ªã„}}{}%
	\ifthenelse{\isundefined{\Color}}{\def\Color{ã‚¢ã‚¯ã‚·ãƒ§ãƒ³}}{}%
	\ifthenelse{\isundefined{\ColorB}}{\let\ColorB\Color}{\let\ColorBa\ColorB}%
	\providecommand{\Artwork}{test.pdf}%
	\IfValueT{#7}{\setboolean{ispile}{true}\newcommand{\Alert}{#7}}%
	\newcommand{\Text}{#8}%
	\IfValueT{#9}{\def\errata{#9}}%
	\begin{tikzpicture}[x=1mm,y=1mm]
		\setlength{\parindent}{1\zw}
		% åº§æ¨™
		\coordinate(OL1)at(63,88);\coordinate(OL3)at(0,0);
		\coordinate(OLE1)at(58,89);\coordinate(OOOO)at(63,89);
		\coordinate(OLE4)at(OLE1|-OL3);
		\coordinate(OOL1)at($(OL1)+(3,3)-(0,.71pt)$);
		\coordinate(OOL3)at($(OL3)-(3,3)-(0,.71pt)$);
		\coordinate(N3)at(3,75);\coordinate(NE1)at(55,85);\coordinate(NJ1)at(55,82);
		\coordinate(NE3)at(NJ1-|N3);\coordinate(NE2)at(NE1-|N3);
		\coordinate(A1)at(54,75);\coordinate(T1)at(54,39);\coordinate(T3)at(4,8);
		\coordinate(A3)at(T1-|T3);
		\coordinate(Y1)at(55,8);\coordinate(Y3)at(3,3);
		\coordinate(Y2)at(Y1-|Y3);\coordinate(Y4)at(Y1|-Y3);
		\coordinate(SE)at(58,77);\coordinate(SN)at(SE);
		\coordinate(SC)at(58,39);\coordinate(SY)at(SC);
		\coordinate(SYC1)at($(SY)+(8,-10)$);\coordinate(SYC2)at(SY|-SYC1);
		\coordinate(SYC4)at($(SYC1)+(0,-10)$);
		\coordinate(CB)at($(Y3)+(2.5,2.5)$);
		\coordinate(CTL)at($(NE2)+(2,-2)$);\coordinate(CTR)at($(NE1)+(-2,-2)$);
		% å¤–æ 
		\useasboundingbox(OL1)rectangle(OL3);
		% ã‚«ãƒ¼ãƒ‰å
		\shadedraw[top color=\Color,bottom color=\ColorB](N3)rectangle(NE1);
		\path(N3)--(NJ1)node[midway,font=\hmnfont\fontsize{6mm}{0}\selectfont]
			{\hminwidth{48mm}{\ifthenelse{\boolean{shortname}}{ã€€\CardNameJAã€€}{\CardNameJA}}};
		\path(NE3)--(NE1)node[midway,font=\hmnfont]{\CardNameEN};
		% å‡ºåŠ›ã‚³ã‚¤ãƒ³
		\ifthenelse{\isundefined{\MC}}{}{
			\path(CTL)node[anchor=center,font=\fontsize{4mm}{0}\selectfont]{\Coin{\MC}};
			\path(CTR)node[anchor=center,font=\fontsize{4mm}{0}\selectfont]{\Coin{\MC}};
		}
		% ã‚¤ãƒ©ã‚¹ãƒˆ
		\draw[path picture={\node at (path picture bounding box.center)
			{\includegraphics[width=50mm,height=36mm,keepaspectratio,min size={50mm}{36mm},clip]
			{\Artwork}};}](A1)-|(A3)-|cycle;
		% ãƒ†ã‚­ã‚¹ãƒˆ
		\shadedraw[top color=\Color,bottom color=\ColorB](T3)rectangle(T1);
		%% ãƒˆãƒ©ãƒ™ãƒ©ãƒ¼
		\ifthenelse{\isundefined{\Travelar}}{}{
			\path(T1)--(T3)node
				[midway,font=\fontspec{nishiki-teki}\fontsize{30mm}{0}\selectfont,color=lightgray]{ğŸ };
		}
		\path(T1)--(T3)node
			[midway,anchor=center,outer sep=0,inner sep=1mm,text width=47.5mm,text justified,color=black]{
				\Text
				\ifthenelse{\boolean{issuply}}{
					\medskip
					\begin{center}
						\hmafont\small ï¼ˆã“ã®ã‚«ãƒ¼ãƒ‰ã¯ã‚µãƒ—ãƒ©ã‚¤ã«ç½®ã‹ãªã„ï¼‰
					\end{center}
				}{}%
				\ifthenelse{\boolean{ispile}}{
					\medskip
					\begin{center}
						\hmafont\hminwidth*{45mm}{\small ï¼ˆ\Alertï¼‰}
					\end{center}
				}{}%
			};
		% å®¶å®
		\ifthenelse{\isundefined{\å®¶å®}}{}{
			\path(Y1)--(Y2)node[midway,above,inner sep=0pt,outer sep=0pt,font=\hmhfont]
				{\colorbox{å®¶å®}{\hmfukuro{å®¶å®: \å®¶å®}}};
		}
		% ã‚¿ã‚¤ãƒ—
		\shadedraw[top color=\Color,bottom color=\ColorB]
			(Y3)rectangle(Y1)node[midway,font=\hmnfont\fontsize{3.5mm}{0}\selectfont]
			{\hminwidth*{42mm}{\Type}};
		% ã‚³ã‚¹ãƒˆ
		\path(CB)node[anchor=center,font=\fontsize{5.4mm}{0}\selectfont]{\CostA};
		% æ‹¡å¼µ
		\fill[fill=\Expantion]($(OOOO)+(3,2)$)rectangle(SE)
			node[anchor=south east,rotate=-90,inner ysep=.25mm,font=\hmsefont\fontsize{4mm}{0}\selectfont]
			{\hminwidth{8mm}{\hmfukuro{\Expantion}}};
		% ã‚«ãƒ¼ãƒ‰åæ¨ª
		\path(SN)node[anchor=south west,rotate=-90,inner ysep=.25mm,font=\hmsfont]
			{\hminwidth*{31mm}{%
				\ltjsetparameter{autoxspacing=false}%
				\fontsize{4mm}{0}\selectfont%
				\ifthenelse{\boolean{issuply}}{â˜…}{}%
				\ifthenelse{\boolean{ispile}}{â˜†}{}%
				\CardNameJA%
				\fontsize{2.5mm}{0}\color{darkgray}\selectfont%
				\ifthenelse{\isundefined{\Copy}}{}{/\Copy æš}%
				\ifthenelse{\isundefined{\AdditionalCard}}{}{{\fontspec{nishiki-teki}ğŸ ¾}\AdditionalCard}%
			}};
		% ã‚³ã‚¹ãƒˆæ¨ª
		\path(SC)node[anchor=south east,rotate=-90,inner ysep=.25mm,font=\fontsize{3.5mm}{0}\selectfont]
			{\CostA};
		% ã‚¿ã‚¤ãƒ—æ¨ª
		\fill[\Color](SY)rectangle(SYC1);
		\ifthenelse{\isundefined{\ColorBa}}{}{\fill[\ColorBa](SYC2)rectangle(SYC4);}
		\path(SY)node[anchor=south west,rotate=-90,inner ysep=.25mm,font=\hmsfont\color{blue}]
			{\hminwidth*{35mm}{\Type}};
		% ã‚¨ãƒ©ãƒƒã‚¿å¹´åº¦
		\path(Y4)node[anchor=south east,inner sep=.25mm]{\tiny\errata};
		% æ–¹çœ¼
		\draw[thin]($(OLE1)+(0,2)$)--($(OLE4)+(0,-3)$);
		\ifgrid
			\draw[very thin,gridcolor,nearly transparent](OOOO)grid[step=1](OL3);
			\draw[thin,gridcolor,nearly transparent](OOOO)grid[step=10](OL3);
			\draw[thin,gridcolor,nearly transparent](OL1)rectangle(OL3);
			\draw[thin,gridcolor,nearly transparent](OLE1)rectangle(OLE4);
		\fi
	\end{tikzpicture}%
	\pagebreak
}}

\define@cmdkeys{info-l}[]{Cost,CostA,Type,Expantion,Artwork,Copy}
\NewDocumentCommand\LandscapeInfo{m m t+ o d() m +m o}{{%
	\newcommand{\CardNameEN}{#1}%
	\newcommand{\CardNameJA}{#2}%
	\newboolean{shortname}\setboolean{shortname}{false}%
	\IfBooleanT{#3}{\setboolean{shortname}{true}}%
	\IfValueT{#4}{\newcommand{\AdditionalCard}{#4}}%
	\IfValueT{#5}{\newcommand{\FromCard}{#5}}%
	\setkeys{info-l}{#6}%
	\ifthenelse{\isundefined{\Cost}}{}{\def\CostA{\Coin{\Cost}}}%
	\ifthenelse{\isundefined{\Color}}{\def\Color{\Type}}{}%
	\providecommand{\Artwork}{test-l.pdf}%
	\newcommand{\Text}{#7}%
	\IfValueT{#8}{\def\errata{#8}}%
	\begin{tikzpicture}[x=1mm,y=1mm]
		\setlength{\parindent}{1\zw}
		% åº§æ¨™
		\coordinate(OL1)at(0,63);\coordinate(OL3)at(88,0);
		\coordinate(OLE1)at(-1,58);\coordinate(OOOO)at(-1,63);
		\coordinate(OLE4)at(OLE1-|OL3);
		\coordinate(OOL1)at($(OL1)+(3,3)-(0,.71pt)$);
		\coordinate(OOL3)at($(OL3)-(3,3)-(0,.71pt)$);
		\coordinate(N3)at(18,45);\coordinate(NE1)at(70,55);\coordinate(NJ1)at(70,52);
		\coordinate(NE3)at(NJ1-|N3);\coordinate(NE2)at(NE1-|N3);
		\coordinate(A1)at(84,48);\coordinate(T1)at(84,28);\coordinate(T3)at(4,3);
		\coordinate(A3)at(T1-|T3);\coordinate(A2)at(A1-|A3);\coordinate(T4)at(T1|-T3);
		\coordinate(CB)at($(A2)+(-1,0)$);
		\coordinate(Y1)at(71,50);\coordinate(Y2)at(86,35);
		\coordinate(SE)at(11,58);\coordinate(SN)at(SE);
		\coordinate(SC)at(49,58);\coordinate(SY)at(SC);
		\coordinate(SYC1)at($(SY)+(10,8)$);
		% å¤–æ 
		\useasboundingbox(OL1)rectangle(OL3);
		% ã‚¤ãƒ©ã‚¹ãƒˆã€ã‚¿ã‚¤ãƒ—
		\draw[path picture={\node at (path picture bounding box.center)
			{\includegraphics[width=80mm,height=20mm,keepaspectratio,min size={80mm}{20mm},clip]{\Artwork}};
			\draw[black,line width=3mm+1pt](Y1)--(Y2);
			\draw[\Color,line width=3mm](Y1)--(Y2)node[midway,sloped,font=\hmnfont,color=black]{\hminwidth*{10mm}{\Type}};
		}](A1)-|(A3)-|cycle;
		% ã‚«ãƒ¼ãƒ‰å
		\filldraw[fill=\Color](N3)rectangle(NE1);
		\path(N3)--(NJ1)node[midway,font=\hmnfont\fontsize{6mm}{0}\selectfont]
			{\hminwidth{48mm}{\ifthenelse{\boolean{shortname}}{ã€€\CardNameJAã€€}{\CardNameJA}}};
		\path(NE3)--(NE1)node[midway,font=\hmnfont]{\CardNameEN};
		% ãƒ†ã‚­ã‚¹ãƒˆ
		\filldraw[fill=\Color](T3)rectangle(T1);
		\path(T1)--(T3)node
			[midway,anchor=center,outer sep=0,inner sep=1mm,text width=47.5mm,text justified,color=black]{
				\Text
			};
		% ã‚³ã‚¹ãƒˆ
		\ifthenelse{\isundefined{\CostA}}{}
			{\path(CB)node[anchor=west,inner sep=0pt,font=\fontsize{5.4mm}{0}\selectfont]{\CostA};}
		% æ‹¡å¼µ
		\fill[fill=\Expantion]($(OOOO)+(-2,3)$)rectangle(SE)
			node[anchor=south east,inner ysep=.25mm,font=\hmsefont\fontsize{4mm}{0}\selectfont]
			{\hminwidth{8mm}{\hmfukuro{\Expantion}}};
		% ã‚«ãƒ¼ãƒ‰åæ¨ª
		\path(SN)node[anchor=south west,inner ysep=.25mm,font=\hmsfont]
			{\hminwidth*{31mm}{%
				\ltjsetparameter{autoxspacing=false}%
				\fontsize{4mm}{0}\selectfont%
				â—%
				\CardNameJA%
				\fontsize{2.5mm}{0}\color{darkgray}\selectfont%
				\ifthenelse{\isundefined{\Copy}}{}{/\Copy æš}%
				\ifthenelse{\isundefined{\AdditionalCard}}{}{{\fontspec{nishiki-teki}ğŸ ¾}\AdditionalCard}%
				\ifthenelse{\isundefined{\FromCard}}{}{\<ï¼ˆ{\fontspec{nishiki-teki}ğŸ ¼}\FromCard ï¼‰\<}%
			}};
		% ã‚³ã‚¹ãƒˆæ¨ª
		\ifthenelse{\isundefined{\CostA}}{}{
			\path(SC)node[anchor=south east,inner ysep=.25mm,font=\fontsize{3.5mm}{0}\selectfont]
				{\CostA};
		}
		% ã‚¿ã‚¤ãƒ—æ¨ª
		\fill[\Color](SY)rectangle(SYC1);
		\path(SY)node[anchor=south west,inner ysep=.25mm,font=\hmsfont\color{blue}]
			{\hminwidth*{35mm}{\Type}};
		% ã‚¨ãƒ©ãƒƒã‚¿å¹´åº¦
		\path(T4)node[anchor=south east,inner sep=.25mm]{\tiny\errata};
		% æ–¹çœ¼
		\draw[thin]($(OLE1)+(-2,0)$)--($(OLE4)+(3,0)$);
		\ifgrid
			\draw[very thin,gridcolor,nearly transparent](OOOO)grid[step=1](OL3);
			\draw[thin,gridcolor,nearly transparent](OOOO)grid[step=10](OL3);
			\draw[thin,gridcolor,nearly transparent](OL1)rectangle(OL3);
			\draw[thin,gridcolor,nearly transparent](OLE1)rectangle(OLE4);
		\fi
	\end{tikzpicture}%
	\pagebreak
}}
\pagestyle{empty}
\setlength{\parindent}{0pt}
